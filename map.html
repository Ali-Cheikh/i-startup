<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Overlay</title>
    
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <!-- Leaflet.js JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
        /* Ensure the map fills the screen and has height */
        #map {
            height: 400px; /* Adjust height as needed */
            width: 100%;
            position: relative;
        }

        /* Overlay styling */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000; /* Ensure it's on top of the map */
        }

        .overlay:hover {
            opacity: 1; /* Fully visible on hover */
        }

        .overlay.hidden {
            display: none; /* Hide overlay on click */
        }

        .overlay-content {
            color: white;
            font-size: 1.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
    </style>
</head>
<body>

    <div class="p-6 mb-12">
        <center>
            <h3 id="user-details" class="max-w-lg p-6 display-5 font-mono font-bold text-yellow-400"></h3>
            <h4 class="text-white text-2xl">You will Get an Email and </h4>
            <div id="map" style="height: 400px; width: 100%;"></div>
            <div id="overlay" class="overlay">
                <div class="overlay-content">
                    <p>Click to close this overlay</p>
                </div>
            </div>
        </center>
    </div>

    <script>
        async function getUserDetails() {
            try {
                const apiKey = 'd8d24867a2d34a28a7e2b1ac98be45b3'; // Replace with your API key

                // Fetch the user's IP and timezone data from ipgeolocation.io
                let response = await fetch(`https://api.ipgeolocation.io/ipgeo?apiKey=${apiKey}`);
                let data = await response.json();

                // Extract IP and time
                let ip = data.ip;
                let time = data.time_zone.current_time.split(" ")[1].substring(0, 5); // Get HH:MM format

                // Display IP and Time in the HTML
                document.getElementById('user-details').innerHTML = `If you are interested in Joining Our Team<br> Time now : ${time} <button id="join-waitlist" class="mt-6 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 font-manrope font-bold">Join the Waitlist</button><br>`;

                // Update time every minute
                setInterval(() => {
                    let currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('user-details').innerHTML = `Join Our Team<br>Your IP: ${ip}<br> Time: ${currentTime} <button id="join-waitlist" class="mt-6 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 font-manrope font-bold">Join the Waitlist</button><br>`;
                }, 60000); // Refresh time every 60 seconds

                // Initialize the map with Leaflet.js centered at the fixed meetup location
                initMap(34.7686605, 10.7492971);

            } catch (error) {
                console.error("Error fetching user details:", error);
            }
        }

        function initMap(lat, lng) {
            var map = L.map('map').setView([lat, lng], 12);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="#idiot" target="services.html">2024 i-startup dev</a>'
            }).addTo(map);

            L.marker([lat, lng]).addTo(map)
                .bindPopup("We will meet you here")
                .openPopup();
        }

        // Call the function when the page loads
        window.onload = getUserDetails;

        // Add click event to hide the overlay
        document.getElementById('overlay').addEventListener('click', function() {
            this.classList.add('hidden');
        });
    </script>

</body>
</html>
